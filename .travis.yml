sudo: required

# It is not really needed, other than for showing correct language tag in Travis CI build log.
language: c
compiler:
  - gcc
  - clang
env:
  global:
   # The next declaration is the encrypted COVERITY_SCAN_TOKEN, created
   #   via the "travis encrypt" command using the project repo's public key
   - secure: "pjWKgP0mznVtydV9YEOrs6zmIAlXMDhHBz6DrUqZM7M4L7ekTpAoTa4KkXfsycecs4eH8dZrsCz8IFQV/jYicyAz8gNbmGR9F6+w7NuX86Cw7xabC41PcdXkfE0r2t4L8xYytDy5I5LnvXr4/8tBcglZWxhzNq+Qxbr/Z5ay+r7Vjtirm2aaF0qdFuHwcp+DoKtlWDrqcbi4pXRB9rgNQWywUA5YqF6IuP4kbCZxoX68KpUyf2zZCTr8ACqD/jkutXiWY7Id6D/bb7n5iesWhdzYUDW76gLfgMeqKdDkh+VbKSi4W70qlSZhOqCM1dbTVg1Jp/LsmLFSajV6RXjHNR7LxrcmHNg3CjBglC9kMGJz49AOd4jkx8yGaLpe0oPU+AsOTeFrbVFCE5YPIgwGGoBpY1FEEvEWP6q/DSSWBkA2ShcrmOoC50KVLPuIEEGty5mZKio/5GQnHsE0jO4h/VkBp+hrPFkYkDEvvYJiE0OUpK65OQy+frChAEkKLifIeuu//p8Q12PRjSg7nHC419SSXAeypci6LLmvPIC2s2+DIHcO17mQKvQAwnv9vLtEuDxGb7I0EII3y15izFOEcySi54G1voG0Pr5CrMtgTYgGtC9YmN7Au831aH5vTwi2AgcDrZzkTNEV5y3FJqWGwqNXc3V2OTSz1BDJp82KZro="

addons:
  coverity_scan:
    project:
      name: "westermo/dhcp-helper"
      description: "dhcp-helper | A DHCP relay agent, with option82 support"
    notification_email: lazzer@gmail.com
    build_command_prepend: "./autogen.sh && ./configure"
    build_command: "make"
    branch_pattern: dev

before_install:
  - docker run --privileged -d --name travis-ci -v $(pwd):/travis ubuntu:xenial tail -f /dev/null
  - docker ps

install:
  - docker exec -t travis-ci bash -c "apt-get update;
    apt-get install -y libnl-3-dev libnl-3-200 libnl-route-3-200 libnl-genl-3-200 libnl-route-3-dev libnl-genl-3-dev libjansson-dev libev-dev build-essential autoconf automake pkg-config clang python-scapy tcpdump iproute2; mv /usr/sbin/tcpdump /usr/local/bin/; ln -s /usr/local/bin/tcpdump /usr/sbin/"

script:
  - docker exec -t travis-ci bash -c "cd /travis; ./autogen.sh && ./configure && make && make check"
