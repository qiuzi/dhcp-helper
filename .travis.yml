sudo: required

# It is not really needed, other than for showing correct language tag in Travis CI build log.
language: c
compiler:
  - gcc
  - clang
env:
  global:
   # The next declaration is the encrypted COVERITY_SCAN_TOKEN, created
   #   via the "travis encrypt" command using the project repo's public key
   - secure: "AVbdU/dw4R3wZCLpleyFNg7jQGvsq9ToOiG9HF0rgOXQtg6GRET6pABjit6gYgTJllSAHLt9fFkRRH1qk02+4mhIUkmO52LZ+KHB4hSc/I4QHeF9aF3L0yNN6HJ3L6eA1Qlm7+vfnjRHoKL37AAlVK6hpovmm5nruxmoHetAYRXurQvPdPYt3Ty9WSmLYNad5Im++WUF+OEyLkmsOYkQ2vZ0PISd0Ad3sMmWWRjiMEwtIPME6j2FO18XT3QvlaBVYaYi/TCWIbPJF9jxBHffZ1yNmj77Lqb4xAXbVYoJ2QP56EZjTDC/7xaaW7TU518WDrWVlqjtyQ1rDMIshIIaY+g0ZLJ8b+TDoaULbuXe0BvKTLgCNi0fgfbkfWOGEs3OvFiIntmfzcKc/0tSA8Btd9OVtAeHKRv9FbPYMhqObGUYMqKCit0V9s4hzUW6q2G4XyEuj2wSPZW4BQkdtLTBOkqx2mPMwIJk34MI9y1jgEwWl0Y6PvBfbbUjD4/6K2FnO3oTObjPxn5/mbOz99UDRFMLlVhsSFsUZ5xiH+GuIiQl7emQgWOy7C0fmbbKKQz8UX7lwHRefkRjnI1+xlJKLkPXSZquJF7LdCLpEGGO3veLlzK9sybyHLqMY/rL0NWXNabatB8QaQkK8d+y3Ee2avvghT+EHoW4pS40nHAedeA="

addons:
  coverity_scan:
    project:
      name: "westermo/dhcp-helper"
      description: "dhcp-helper | A DHCP relay agent, with option82 support"
    notification_email: lazzer@gmail.com
    build_command_prepend: "./autogen.sh && ./configure"
    build_command: "make"
    branch_pattern: dev

before_install:
  - docker run --privileged -d --name travis-ci -v $(pwd):/travis ubuntu:xenial tail -f /dev/null
  - docker ps

install:
  - docker exec -t travis-ci bash -c "apt-get update;
    apt-get install -y libnl-3-dev libnl-3-200 libnl-route-3-200 libnl-genl-3-200 libnl-route-3-dev libnl-genl-3-dev libjansson-dev libev-dev build-essential autoconf automake pkg-config clang python-scapy tcpdump iproute2; mv /usr/sbin/tcpdump /usr/local/bin/; ln -s /usr/local/bin/tcpdump /usr/sbin/"

script:
  - docker exec -t travis-ci bash -c "cd /travis; ./autogen.sh && ./configure && make && make check"
